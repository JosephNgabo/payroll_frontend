<div class="container-fluid">
  <h2 class="fw-bold mb-3">List Payrolls</h2>

  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading payrolls...</p>
  </div>

  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <div *ngIf="!loading && !error">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="bg-light">
          <tr>
            <th>Payroll Number</th>
            <th>Payroll Month</th>
            <th>Payroll Year</th>
            <th>Status</th>
            <th>Created At</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let payroll of payrolls">
            <td>{{ payroll.payroll_number }}</td>
            <td>{{ getMonthName(payroll.payroll_month) }}</td>
            <td>{{ payroll.payroll_year }}</td>
            <td>{{ getStatusText(payroll.payroll_status) }}</td>
            <td>{{ payroll.created_at | date:'medium' }}</td>
            <td>
              <a class="btn btn-sm btn-primary me-2" [routerLink]="['/payroll/details', payroll.id]">View Details</a>
              <button class="btn btn-sm btn-warning me-2" (click)="openRegenerateModal(payroll)"><i class="bx bx-refresh"></i> Regenerate</button>
              <button class="btn btn-sm btn-danger" (click)="deletePayroll(payroll)"><i class="bx bx-trash"></i> Delete</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <nav *ngIf="totalPages > 1" class="mt-3">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <a class="page-link" href="#" (click)="onPageChange(currentPage - 1); $event.preventDefault();">Previous</a>
        </li>
        <li class="page-item" *ngFor="let link of links" [class.active]="link.active" [class.disabled]="!link.url">
          <a class="page-link" href="#" (click)="onPageChange(getPageNumberFromUrl(link.url)); $event.preventDefault();" [innerHTML]="link.label"></a>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <a class="page-link" href="#" (click)="onPageChange(currentPage + 1); $event.preventDefault();">Next</a>
        </li>
      </ul>
    </nav>
  </div>
</div>

<!-- Regenerate Payroll Modal -->
<ng-template #regenerateModal let-modal>
  <div class="modal-header">
    <h5 class="modal-title">Regenerate Payroll</h5>
    <button type="button" class="btn-close" aria-hidden="true" (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body">
    <div class="mb-3">
      <label for="regenerateMonth" class="form-label">Select Month</label>
      <ng-select
        id="regenerateMonth"
        [items]="monthOptions"
        bindLabel="label"
        bindValue="value"
        placeholder="Select Month"
        [(ngModel)]="selectedRegenerateMonth"
        [clearable]="false">
      </ng-select>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Cancel</button>
    <button type="button" class="btn btn-warning" (click)="confirmRegenerate(modal)">
      <i class="bx bx-refresh"></i> Regenerate
    </button>
  </div>
</ng-template> 