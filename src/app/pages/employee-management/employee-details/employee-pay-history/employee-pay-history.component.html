<!-- Pay History List -->
<div class="bg-white p-4 rounded shadow-sm mb-4">
  <h6 class="mb-3">Pay History</h6>
  
  <div *ngIf="loading" class="text-center py-4">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading pay history...</p>
  </div>

  <div *ngIf="!loading && employeePayHistory.length === 0" class="text-center py-4">
    <i class="fas fa-file-invoice-dollar text-muted" style="font-size: 3rem;"></i>
    <p class="text-muted mt-2">No pay history found for this employee.</p>
  </div>

  <div *ngIf="!loading && employeePayHistory.length > 0" class="table-responsive">
    <table class="table table-hover">
      <thead class="table-light">
        <tr>
          <th>Payroll Date</th>
          <th>Payslip No</th>
          <th>Basic Salary</th>
          <th>Gross Salary</th>
          <th>Net Salary</th>
          <!-- <th>Status</th> -->
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let payslip of employeePayHistory">
          <td>{{ payslip.payroll_date | date:'yyyy-MM-dd' }}</td>
          <td>{{ payslip.payslip_number || '-' }}</td>
          <td>{{ payslip.basic_salary | numberFormat }}</td>
          <td>{{ payslip.total_gross_salary | numberFormat }}</td>
          <td class="fw-bold text-success">{{ payslip.total_net_salary | numberFormat }}</td>
          <!-- <td>
            <span class="badge" [ngClass]="getStatusBadgeClass(payslip.status)">
              {{ payslip.status || 'PENDING' }}
            </span>
          </td> -->
          <td>
            <button class="btn btn-sm btn-outline-primary" (click)="openPayslipDetails(payslip)">
              <i class="fas fa-eye me-1"></i>View Details
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Payslip Details Modal -->
<div *ngIf="showPayslipDetails && selectedPayslip" class="modal fade show d-block" style="background-color: rgba(0,0,0,0.5);">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">
          <i class="fas fa-file-invoice-dollar me-2"></i>Payslip Details
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="closePayslipDetails()"></button>
      </div>
      <div class="modal-body">
        <!-- Employee and Payroll Info -->
        <div class="row g-3 mb-4">
          <div class="col-md-6">
            <div class="card border-0 shadow-sm">
              <div class="card-body p-3">
                <h6 class="fw-bold mb-2 text-primary">
                  <i class="fas fa-user me-1"></i> Employee Info
                </h6>
                <div class="mb-1">
                  <strong>Name:</strong> {{ employee?.first_name }} {{ employee?.last_name }}
                </div>
                <div class="mb-1">
                  <strong>Phone:</strong> {{ employee?.personal_mobile }}
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="card border-0 shadow-sm">
              <div class="card-body p-3">
                <h6 class="fw-bold mb-2 text-primary">
                  <i class="fas fa-calendar me-1"></i> Payroll Info
                </h6>
                <div class="mb-1">
                  <strong>Date:</strong> {{ selectedPayslip.payroll_date | date:'yyyy-MM-dd' }}
                </div>
                <div class="mb-1">
                  <strong>Payslip No:</strong> {{ selectedPayslip.payslip_number || '-' }}
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Salary Summary -->
        <div class="table-responsive mb-4">
          <table class="table table-bordered align-middle mb-0">
            <tbody>
              <tr>
                <th class="bg-light">
                  <i class="fas fa-money-bill me-1"></i> Basic Salary
                </th>
                <td class="fw-bold text-primary">{{ selectedPayslip.basic_salary | numberFormat }}</td>
              </tr>
              <tr>
                <th class="bg-light">
                  <i class="fas fa-gift me-1"></i> Total Allowances
                </th>
                <td class="fw-bold text-info">{{ selectedPayslip.total_allowances | numberFormat }}</td>
              </tr>
              <tr>
                <th class="bg-light">
                  <i class="fas fa-chart-line me-1"></i> Total Gross Salary
                </th>
                <td class="fw-bold text-success fs-5">{{ selectedPayslip.total_gross_salary | numberFormat }}</td>
              </tr>
              <tr>
                <th class="bg-light">
                  <i class="fas fa-user-minus me-1"></i> Total RSSB EE
                </th>
                <td class="fw-bold text-warning">{{ selectedPayslip.total_rssb_employee_deductions | numberFormat }}</td>
              </tr>
              <tr>
                <th class="bg-light">
                  <i class="fas fa-building me-1"></i> Total RSSB ER
                </th>
                <td class="fw-bold text-warning">{{ selectedPayslip.total_rssb_employer_deductions | numberFormat }}</td>
              </tr>
              <tr>
                <th class="bg-light">
                  <i class="fas fa-minus-circle me-1"></i> Total Other Deduction
                </th>
                <td class="fw-bold text-danger">{{ selectedPayslip.total_other_deductions | numberFormat }}</td>
              </tr>
              <tr>
                <th class="bg-light">
                  <i class="fas fa-percent me-1"></i> Total PAYE
                </th>
                <td class="fw-bold text-danger">{{ selectedPayslip.total_paye_deductions | numberFormat }}</td>
              </tr>
              <tr>
                <th class="bg-light">
                  <i class="fas fa-wallet me-1"></i> Total Net Salary
                </th>
                <td class="fw-bold text-success fs-5">{{ selectedPayslip.total_net_salary | numberFormat }}</td>
              </tr>
              <tr>
                <th class="bg-light">
                  <i class="fas fa-stack-overflow me-1"></i> Total Mass Salary
                </th>
                <td class="fw-bold text-dark">{{ selectedPayslip.total_mass_salary | numberFormat }}</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- RSSB Details -->
        <div *ngIf="selectedPayslip.rssb_details && selectedPayslip.rssb_details.length > 0">
          <div class="mb-2 fw-bold text-primary bg-light p-2 rounded">
            <i class="fas fa-shield-alt me-1"></i> RSSB Details
          </div>
          <div class="table-responsive mb-3">
            <table class="table table-bordered align-middle mb-0">
              <thead class="table-primary">
                <tr>
                  <th>Name</th>
                  <th>Base</th>
                  <th>Employee Rate</th>
                  <th>Employer Rate</th>
                  <th>Employee Amount</th>
                  <th>Employer Amount</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let rssb of selectedPayslip.rssb_details">
                  <td>{{ rssb.name }}</td>
                  <td>{{ rssb.base | numberFormat }}</td>
                  <td>{{ rssb.employee_contribution_rate | percent:'1.0-2' }}</td>
                  <td>{{ rssb.employer_contribution_rate | percent:'1.0-2' }}</td>
                  <td class="text-success fw-bold">{{ rssb.employee_contribution_amount | numberFormat }}</td>
                  <td class="text-info fw-bold">{{ rssb.employer_contribution_amount | numberFormat }}</td>
                </tr>
                <tr>
                  <th class="text-end" colspan="4">Total</th>
                  <th class="text-success fw-bold">{{ getRssbEmployeeTotal() | numberFormat }}</th>
                  <th class="text-info fw-bold">{{ getRssbEmployerTotal() | numberFormat }}</th>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Allowances Details -->
        <div *ngIf="selectedPayslip.allowance_details && selectedPayslip.allowance_details.length > 0">
          <div class="mb-2 fw-bold text-info bg-info-subtle p-2 rounded">
            <i class="fas fa-gift me-1"></i> Allowances Details
          </div>
          <div class="table-responsive mb-3">
            <table class="table table-bordered align-middle mb-0">
              <thead class="table-info">
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Rate/Amount</th>
                  <th>Calculated Amount</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let allowance of selectedPayslip.allowance_details">
                  <td>{{ allowance.name }}</td>
                  <td>{{ allowance.type }}</td>
                  <td>{{ allowance.rate_or_amount | numberFormat }}</td>
                  <td class="text-success fw-bold">{{ allowance.calculated_amount | numberFormat }}</td>
                </tr>
                <tr class="bg-info-subtle">
                  <th class="text-end" colspan="3">Total</th>
                  <th class="text-success fw-bold">{{ getAllowanceTotal() | numberFormat }}</th>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Other Deductions Details -->
        <div *ngIf="selectedPayslip.other_deduction_details && selectedPayslip.other_deduction_details.length > 0">
          <div class="mb-2 fw-bold text-danger bg-danger-subtle p-2 rounded">
            <i class="fas fa-minus-circle me-1"></i> Other Deductions Details
          </div>
          <div class="table-responsive mb-3">
            <table class="table table-bordered align-middle mb-0">
              <thead class="table-danger">
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Rate/Amount</th>
                  <th>Calculated Amount</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let deduction of selectedPayslip.other_deduction_details">
                  <td>{{ deduction.name }}</td>
                  <td>{{ deduction.type }}</td>
                  <td>{{ deduction.rate_or_amount | numberFormat }}</td>
                  <td class="text-danger fw-bold">{{ deduction.calculated_amount | numberFormat }}</td>
                </tr>
                <tr class="bg-danger-subtle">
                  <th class="text-end" colspan="3">Total</th>
                  <th class="text-danger fw-bold">{{ getOtherDeductionTotal() | numberFormat }}</th>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closePayslipDetails()">Close</button>
      </div>
    </div>
  </div>
</div> 