<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h4 class="card-title mb-0">
      <i *ngIf="widgetIcon" [class]="widgetIcon + ' me-2'"></i>
      {{ widgetTitle }}
    </h4>
    <button class="btn btn-sm btn-outline-primary" (click)="refreshWidget()" [disabled]="isLoading">
      <i class="bx bx-refresh"></i>
    </button>
  </div>
  
  <div class="card-body">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="text-center py-3">
      <div class="spinner-border spinner-border-sm text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="text-muted mt-2">Loading {{ widgetTitle }}...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !isLoading" class="alert alert-danger" role="alert">
      <i class="bx bx-error-circle me-2"></i>
      {{ error }}
      <button class="btn btn-sm btn-outline-danger ms-2" (click)="refreshWidget()" 
              *ngIf="!error.includes('permission') && !error.includes('Access denied')">
        Retry
      </button>
    </div>

    <!-- Widget Content -->
    <div *ngIf="!isLoading && !error && widgetData">
      <!-- Stats Widget -->
      <div *ngIf="widgetType === 'stats'">
        <div class="text-center mb-3">
          <h3 class="text-primary">{{ getWidgetDisplayData()?.total || 0 }}</h3>
          <p class="text-muted">{{ widgetTitle }}</p>
        </div>
        
        <!-- Stats Grid -->
        <div class="row" *ngIf="getWidgetDisplayData()?.items?.length">
          <div class="col-6" *ngFor="let item of getWidgetDisplayData().items">
            <div class="text-center">
              <h5 [class]="'text-' + item.color">{{ item.value }}</h5>
              <small class="text-muted">{{ item.label }}</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Table Widget -->
      <div *ngIf="widgetType === 'table'">
        <div class="table-responsive">
          <table class="table table-sm">
            <thead>
              <tr>
                <th *ngIf="widgetName === 'team_leave_today'">Employee</th>
                <th *ngIf="widgetName === 'team_leave_today'">Leave Type</th>
                <th *ngIf="widgetName === 'team_leave_today'">Duration</th>
                
                <th *ngIf="widgetName === 'pending_leave_requests'">Employee</th>
                <th *ngIf="widgetName === 'pending_leave_requests'">Leave Type</th>
                <th *ngIf="widgetName === 'pending_leave_requests'">Start Date</th>
                <th *ngIf="widgetName === 'pending_leave_requests'">Days</th>
                <th *ngIf="widgetName === 'pending_leave_requests'">Status</th>
              </tr>
            </thead>
            <tbody>
              <!-- Team Leave Today -->
              <tr *ngFor="let item of getWidgetDisplayData()?.items">
                <td *ngIf="widgetName === 'team_leave_today'">{{ item.employee_name }}</td>
                <td *ngIf="widgetName === 'team_leave_today'">{{ item.leave_type }}</td>
                <td *ngIf="widgetName === 'team_leave_today'">{{ item.days }} days</td>
                
                <!-- Pending Leave Requests -->
                <td *ngIf="widgetName === 'pending_leave_requests'">{{ item.employee_name }}</td>
                <td *ngIf="widgetName === 'pending_leave_requests'">{{ item.leave_type }}</td>
                <td *ngIf="widgetName === 'pending_leave_requests'">{{ formatDate(item.start_date) }}</td>
                <td *ngIf="widgetName === 'pending_leave_requests'">{{ item.days }}</td>
                <td *ngIf="widgetName === 'pending_leave_requests'">
                  <span [class]="'badge ' + getApprovalStatusBadgeClass(item.approval_status)">
                    {{ getApprovalStatusLabel(item.approval_status) }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- List Widget -->
      <div *ngIf="widgetType === 'list'">
        <ul class="list-unstyled">
          <li *ngFor="let item of getWidgetDisplayData()?.items" class="mb-2">
            <div class="d-flex justify-content-between align-items-center">
              <span>{{ item.label || item.name }}</span>
              <span [class]="'badge bg-' + (item.color || 'primary')">{{ item.value }}</span>
            </div>
          </li>
        </ul>
      </div>

      <!-- Chart Widget -->
      <div *ngIf="widgetType === 'chart'">
        <div class="text-center">
          <p class="text-muted">Chart visualization for {{ widgetTitle }}</p>
          <!-- Chart component can be added here -->
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && !error && !widgetData" class="text-center py-3">
      <i class="bx bx-data font-size-48 text-muted"></i>
      <p class="text-muted mt-2">No data available for {{ widgetTitle }}</p>
    </div>
  </div>
</div>
